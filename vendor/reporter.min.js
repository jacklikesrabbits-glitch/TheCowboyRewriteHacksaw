//! TrackJS JavaScript error monitoring agent.
//! COPYRIGHT (c) 2023 ALL RIGHTS RESERVED
//! See License at https://trackjs.com/terms/
var y=function(a,f,h){var v=function(t,r){this.config=t,this.onError=r,t.enabled&&this.watch()};v.prototype={watch:function(){o.forEach(["EventTarget","Node","XMLHttpRequest"],function(t){o.has(a,t+".prototype.addEventListener")&&o.hasOwn(a[t].prototype,"addEventListener")&&this.wrapEventTarget(a[t].prototype)},this),this.wrapTimer("setTimeout"),this.wrapTimer("setInterval")},wrap:function(t){function r(){try{return t.apply(this,arguments)}catch(c){throw e.onError("catch",c,{bindTime:n,bindStack:i}),o.wrapError(c)}}var e=this;try{if(!o.isFunction(t)||o.hasOwn(t,"__trackjs__"))return t;if(o.hasOwn(t,"__trackjs_state__"))return t.__trackjs_state__}catch(c){return t}var n,i;if(e.config.bindStack)try{throw Error()}catch(c){i=c.stack,n=o.isoNow()}for(var s in t)o.hasOwn(t,s)&&(r[s]=t[s]);return r.prototype=t.prototype,r.__trackjs__=!0,t.__trackjs_state__=r},wrapEventTarget:function(t){var r=this;o.has(t,"addEventListener.call")&&o.has(t,"removeEventListener.call")&&(o.patch(t,"addEventListener",function(e){return function(n,i,s,c){try{o.has(i,"handleEvent")&&(i.handleEvent=r.wrap(i.handleEvent))}catch(u){}return e.call(this,n,r.wrap(i),s,c)}}),o.patch(t,"removeEventListener",function(e){return function(n,i,s,c){try{i=i&&(i.__trackjs_state__||i)}catch(u){}return e.call(this,n,i,s,c)}}))},wrapTimer:function(t){var r=this;o.patch(a,t,function(e){return function(n,i){var s=Array.prototype.slice.call(arguments),c=s[0];return o.isFunction(c)&&(s[0]=r.wrap(c)),o.has(e,"apply")?e.apply(this,s):e(s[0],s[1])}})}};var w=function(t){this.initCurrent(t)||console.warn("[TrackJS] invalid config")};w.prototype={current:{},initOnly:{application:!0,cookie:!0,enabled:!0,token:!0,callback:{enabled:!0},console:{enabled:!0},navigation:{enabled:!0},network:{enabled:!0,fetch:!0},visitor:{enabled:!0},window:{enabled:!0,promise:!0}},defaults:{application:"",cookie:!1,dedupe:!0,dependencies:!0,enabled:!0,forwardingDomain:"",errorURL:"https://capture.trackjs.com/capture",errorNoSSLURL:"http://capture.trackjs.com/capture",faultURL:"https://usage.trackjs.com/fault.gif",usageURL:"https://usage.trackjs.com/usage.gif",onError:function(){return!0},serialize:function(t){function r(i){var s="<"+i.tagName.toLowerCase();i=i.attributes||[];for(var c=0;c<i.length;c++)s+=" "+i[c].name+'="'+i[c].value+'"';return s+">"}if(t==="")return"Empty String";if(t===h)return"undefined";if(o.isString(t)||o.isNumber(t)||o.isBoolean(t)||o.isFunction(t))return""+t;if(o.isElement(t))return r(t);if(typeof t==="symbol")return Symbol.prototype.toString.call(t);var e;try{e=JSON.stringify(t,function(i,s){return s===h?"undefined":o.isNumber(s)&&isNaN(s)?"NaN":o.isError(s)?{name:s.name,message:s.message,stack:s.stack}:o.isElement(s)?r(s):s})}catch(i){e="";for(var n in t)if(t.hasOwnProperty(n))try{e+=',"'+n+'":"'+t[n]+'"'}catch(s){}e=e?"{"+e.replace(",","")+"}":"Unserializable Object"}return e.replace(/"undefined"/g,"undefined").replace(/"NaN"/g,"NaN")},sessionId:"",token:"",userId:"",version:"",callback:{enabled:!0,bindStack:!1},console:{enabled:!0,display:!0,error:!0,warn:!1,watch:["log","debug","info","warn","error"]},navigation:{enabled:!0},network:{enabled:!0,error:!0,fetch:!0},visitor:{enabled:!0},window:{enabled:!0,promise:!0}},initCurrent:function(t){if(this.removeEmpty(t),this.validate(t,this.defaults,"[TrackJS] config",{}))return this.current=o.defaultsDeep({},t,this.defaults),!0;return this.current=o.defaultsDeep({},this.defaults),!1},setCurrent:function(t){return this.validate(t,this.defaults,"[TrackJS] config",this.initOnly)?(this.current=o.defaultsDeep({},t,this.current),!0):!1},removeEmpty:function(t){for(var r in t)t.hasOwnProperty(r)&&t[r]===h&&delete t[r]},validate:function(t,r,e,n){var i=!0;e=e||"",n=n||{};for(var s in t)if(t.hasOwnProperty(s))if(r.hasOwnProperty(s)){var c=typeof r[s];c!==typeof t[s]?(console.warn(e+"."+s+": property must be type "+c+"."),i=!1):Object.prototype.toString.call(t[s])!=="[object Array]"||this.validateArray(t[s],r[s],e+"."+s)?Object.prototype.toString.call(t[s])==="[object Object]"?i=this.validate(t[s],r[s],e+"."+s,n[s]):n.hasOwnProperty(s)&&(console.warn(e+"."+s+": property cannot be set after load."),i=!1):i=!1}else console.warn(e+"."+s+": property not supported."),i=!1;return i},validateArray:function(t,r,e){var n=!0;e=e||"";for(var i=0;i<t.length;i++)o.contains(r,t[i])||(console.warn(e+"["+i+"]: invalid value: "+t[i]+"."),n=!1);return n}};var E=function(t,r,e,n,i,s,c){this.util=t,this.log=r,this.onError=e,this.onFault=n,this.serialize=i,c.enabled&&(s.console=this.wrapConsoleObject(s.console,c))};E.prototype={wrapConsoleObject:function(t,r){t=t||{};var e=t.log||function(){},n=this,i;for(i=0;i<r.watch.length;i++)(function(s){var c=t[s]||e;t[s]=function(){try{var u=Array.prototype.slice.call(arguments);if(n.log.add("c",{timestamp:n.util.isoNow(),severity:s,message:n.serialize(u.length===1?u[0]:u)}),r[s])if(o.isError(u[0])&&u.length===1)n.onError("console",u[0]);else try{throw Error(n.serialize(u.length===1?u[0]:u))}catch(p){n.onError("console",p)}r.display&&(n.util.hasFunction(c,"apply")?c.apply(t,u):c(u[0]))}catch(p){n.onFault(p)}}})(r.watch[i]);return t},report:function(){return this.log.all("c")}};var S=function(t,r,e,n,i){this.config=t,this.util=r,this.log=e,this.window=n,this.document=i,this.correlationId=this.token=null,this.initialize()};S.prototype={initialize:function(){this.token=this.getCustomerToken(),this.correlationId=this.getCorrelationId()},getCustomerToken:function(){if(this.config.current.token)return this.config.current.token;var t=this.document.getElementsByTagName("script");return t[t.length-1].getAttribute("data-token")},getCorrelationId:function(){var t;if(!this.config.current.cookie)return this.util.uuid();try{t=this.document.cookie.replace(/(?:(?:^|.*;\s*)TrackJS\s*\=\s*([^;]*).*$)|^.*$/,"$1"),t||(t=this.util.uuid(),this.document.cookie="TrackJS="+t+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/")}catch(r){t=this.util.uuid()}return t},report:function(){return{application:this.config.current.application,correlationId:this.correlationId,sessionId:this.config.current.sessionId,token:this.token,userId:this.config.current.userId,version:this.config.current.version}}};var _=function(t){this.config=t,this.loadedOn=new Date().getTime(),this.originalUrl=o.getLocation(),this.referrer=o.isBrowser?f.referrer:""};_.prototype={discoverDependencies:function(){var t={TrackJS:"3.10.4"};a.jQuery&&a.jQuery.fn&&a.jQuery.fn.jquery&&(t.jQuery=a.jQuery.fn.jquery),a.jQuery&&a.jQuery.ui&&a.jQuery.ui.version&&(t.jQueryUI=a.jQuery.ui.version),a.angular&&a.angular.version&&a.angular.version.full&&(t.angular=a.angular.version.full);for(var r in a)if(r!=="_trackJs"&&r!=="_trackJS"&&r!=="_trackjs"&&r!=="webkitStorageInfo"&&r!=="webkitIndexedDB"&&r!=="top"&&r!=="parent"&&r!=="frameElement")try{if(a[r]){var e=a[r].version||a[r].Version||a[r].VERSION;typeof e==="string"&&(t[r]=e)}}catch(n){}return t.TrackJS&&t.trackJs&&delete t.trackJs,t},report:function(){return{age:new Date().getTime()-this.loadedOn,dependencies:this.config.current.dependencies?this.discoverDependencies():{trackJs:"3.10.4"},originalUrl:this.originalUrl,referrer:this.referrer,userAgent:a.navigator.userAgent,viewportHeight:o.isBrowser?a.document.documentElement.clientHeight:0,viewportWidth:o.isBrowser?a.document.documentElement.clientWidth:0}}};var j=function(t){this.util=t,this.appender=[],this.maxLength=30};j.prototype={all:function(t){var r=[],e,n;for(n=0;n<this.appender.length;n++)(e=this.appender[n])&&e.category===t&&r.push(e.value);return r},clear:function(){this.appender.length=0},truncate:function(){this.appender.length>this.maxLength&&(this.appender=this.appender.slice(Math.max(this.appender.length-this.maxLength,0)))},add:function(t,r){var e=this.util.uuid();return this.appender.push({key:e,category:t,value:r}),this.truncate(),e},get:function(t,r){var e,n;for(n=0;n<this.appender.length;n++)if(e=this.appender[n],e.category===t&&e.key===r)return e.value;return!1}};var I=function(t){var r={};return{addMetadata:function(e,n){r[e]=n},removeMetadata:function(e){delete r[e]},report:function(){var e=[],n;for(n in r)r.hasOwnProperty(n)&&e.push({key:n,value:t(r[n])});return e},store:r}},x=function(t,r){this.log=t,this.options=r,r.enabled&&this.watch()};x.prototype={isCompatible:function(t){return t=t||a,!o.has(t,"chrome.app.runtime")&&o.has(t,"addEventListener")&&o.has(t,"history.pushState")},record:function(t,r,e){this.log.add("h",{type:t,from:o.truncate(r,250),to:o.truncate(e,250),on:o.isoNow()})},report:function(){return this.log.all("h")},watch:function(){if(this.isCompatible()){var t=this,r=o.getLocationURL().relative;a.addEventListener("popstate",function(){var e=o.getLocationURL().relative;t.record("popState",r,e),r=e},!0),o.forEach(["pushState","replaceState"],function(e){o.patch(history,e,function(n){return function(){r=o.getLocationURL().relative;var i=n.apply(this,arguments),s=o.getLocationURL().relative;return t.record(e,r,s),r=s,i}})})}}};var T=function(t,r,e,n,i,s){this.util=t,this.log=r,this.onError=e,this.onFault=n,this.window=i,this.options=s,s.enabled&&this.initialize(i)};T.prototype={initialize:function(t){t.XMLHttpRequest&&this.util.hasFunction(t.XMLHttpRequest.prototype.open,"apply")&&this.watchNetworkObject(t.XMLHttpRequest),t.XDomainRequest&&this.util.hasFunction(t.XDomainRequest.prototype.open,"apply")&&this.watchNetworkObject(t.XDomainRequest),this.options.fetch&&o.isWrappableFunction(t.fetch)&&this.watchFetch()},escapeUrl:function(t){return(""+t).replace(/ /gi,"%20").replace(/\t/gi,"%09")},watchFetch:function(){var t=this,r=this.log,e=this.options,n=this.onError;o.patch(a,"fetch",function(i){return function(s,c){if(c&&c.__trackjs__)return i.apply(a,arguments);var u;try{throw Error()}catch(l){u=l.stack}var m=s instanceof Request?s.url:s,p=s instanceof Request?s.method:(c||{}).method||"GET",m=t.escapeUrl(m),g=i.apply(a,arguments);return g.__trackjs_state__=r.add("n",{type:"fetch",startedOn:o.isoNow(),method:p,url:o.truncate(m,2000)}),g.then(function(l){var d=r.get("n",g.__trackjs_state__);if(d){o.defaults(d,{completedOn:o.isoNow(),statusCode:l.status,statusText:l.statusText});var N=l.headers.get("trackjs-correlation-id");N&&(d.requestCorrelationId=N),e.error&&400<=l.status&&(d=Error(d.statusCode+" : "+d.method+" "+d.url),d.stack=u,n("ajax",d))}return l}).catch(function(l){l=l||{};var d=r.get("n",g.__trackjs_state__);throw d&&(o.defaults(d,{completedOn:o.isoNow(),statusCode:0,statusText:l.toString()}),e.error&&(n("ajax",{name:l.name,message:(l.message||"Failed")+": "+d.method+" "+d.url,stack:l.stack||u}),l.__trackjs_state__=!0)),l})}})},watchNetworkObject:function(t){var r=this,e=t.prototype.open,n=t.prototype.send;return t.prototype.open=function(i,s){var c=(s||"").toString();return 0>c.indexOf("localhost:0")&&(c=r.escapeUrl(c),this._trackJs={method:i,url:c}),e.apply(this,arguments)},t.prototype.send=function(){if(!this._trackJs)try{return n.apply(this,arguments)}catch(i){r.onError("ajax",i);return}try{this._trackJs.logId=r.log.add("n",{type:"xhr",startedOn:r.util.isoNow(),method:this._trackJs.method,url:o.truncate(this._trackJs.url,2000)}),r.listenForNetworkComplete(this)}catch(i){r.onFault(i)}return n.apply(this,arguments)},t},listenForNetworkComplete:function(t){var r=this;r.window.ProgressEvent&&t.addEventListener&&t.addEventListener("readystatechange",function(){t.readyState===4&&r.finalizeNetworkEvent(t)},!0),t.addEventListener?t.addEventListener("load",function(){r.finalizeNetworkEvent(t),r.checkNetworkFault(t)},!0):setTimeout(function(){try{var e=t.onload;t.onload=function(){r.finalizeNetworkEvent(t),r.checkNetworkFault(t),typeof e==="function"&&r.util.hasFunction(e,"apply")&&e.apply(t,arguments)};var n=t.onerror;t.onerror=function(){r.finalizeNetworkEvent(t),r.checkNetworkFault(t),typeof oldOnError==="function"&&n.apply(t,arguments)}}catch(i){r.onFault(i)}},0)},finalizeNetworkEvent:function(t){if(t._trackJs){var r=this.log.get("n",t._trackJs.logId);r&&(r.completedOn=this.util.isoNow(),t.getAllResponseHeaders&&t.getResponseHeader&&0<=(t.getAllResponseHeaders()||"").toLowerCase().indexOf("trackjs-correlation-id")&&(r.requestCorrelationId=t.getResponseHeader("trackjs-correlation-id")),r.statusCode=t.status==1223?204:t.status,r.statusText=t.status==1223?"No Content":t.statusText)}},checkNetworkFault:function(t){if(this.options.error&&400<=t.status&&t.status!=1223){var r=t._trackJs||{};this.onError("ajax",t.status+" : "+r.method+" "+r.url)}},report:function(){return this.log.all("n")}};var k=function(t,r){this.util=t,this.config=r,this.disabled=!1,this.throttleStats={attemptCount:0,throttledCount:0,lastAttempt:new Date().getTime()},a.JSON&&a.JSON.stringify||(this.disabled=!0)};k.prototype={errorEndpoint:function(t){var r=this.config.current,e=r.errorURL;return o.isBrowser&&!o.testCrossdomainXhr()&&a.location.protocol.indexOf("https")===-1?e=r.errorNoSSLURL:r.forwardingDomain&&(e="https://"+r.forwardingDomain+"/capture"),e+"?token="+t+"&v=3.10.4"},usageEndpoint:function(t){var r=this.config.current,e=r.usageURL;return r.forwardingDomain&&(e="https://"+r.forwardingDomain+"/usage.gif"),this.appendObjectAsQuery(t,e)},trackerFaultEndpoint:function(t){var r=(this.config||{}).current||w.prototype.defaults,e=r.faultURL;return r.forwardingDomain&&(e="https://"+r.forwardingDomain+"/fault.gif"),this.appendObjectAsQuery(t,e)},appendObjectAsQuery:function(t,r){r+="?";for(var e in t)t.hasOwnProperty(e)&&(r+=encodeURIComponent(e)+"="+encodeURIComponent(t[e])+"&");return r},getCORSRequest:function(t,r){var e;return this.util.testCrossdomainXhr()?(e=new a.XMLHttpRequest,e.open(t,r),e.setRequestHeader("Content-Type","text/plain")):typeof a.XDomainRequest!=="undefined"?(e=new a.XDomainRequest,e.open(t,r)):e=null,e},sendTrackerFault:function(t){this.throttle(t)||(o.isBrowser?f.createElement("img").src=this.trackerFaultEndpoint(t):fetch(this.trackerFaultEndpoint(t),{mode:"no-cors",__trackjs__:!0}))},sendUsage:function(t){o.isBrowser?f.createElement("img").src=this.usageEndpoint(t):fetch(this.usageEndpoint(t),{mode:"no-cors",__trackjs__:!0})},sendError:function(t,r){var e=this;if(!this.disabled&&!this.throttle(t))try{if(o.isBrowser){var n=this.getCORSRequest("POST",this.errorEndpoint(r));n.onreadystatechange=function(){n.readyState!==4||o.contains([200,202],n.status)||(e.disabled=!0)},n._trackJs=h,n.send(a.JSON.stringify(t))}else if(o.isWorker){var i={method:"POST",mode:"cors",body:a.JSON.stringify(t),__trackjs__:1};fetch(this.errorEndpoint(r),i).then(function(s){s.ok||(e.disabled=!0)}).catch(function(s){e.disabled=!0})}}catch(s){throw this.disabled=!0,s}},throttle:function(t){var r=new Date().getTime();if(this.throttleStats.attemptCount++,this.throttleStats.lastAttempt+1000>=r){if(this.throttleStats.lastAttempt=r,10<this.throttleStats.attemptCount)return this.throttleStats.throttledCount++,!0}else t.throttled=this.throttleStats.throttledCount,this.throttleStats.attemptCount=0,this.throttleStats.lastAttempt=r,this.throttleStats.throttledCount=0;return!1}};var o=function(){function t(e,n,i,s){return i=i||!1,s=s||0,o.forEach(n,function(c){o.forEach(o.keys(c),function(u){c[u]===null||c[u]===h?e[u]=c[u]:i&&10>s&&r(c[u])==="[object Object]"?(e[u]=e[u]||{},t(e[u],[c[u]],i,s+1)):e.hasOwnProperty(u)||(e[u]=c[u])})}),e}function r(e){return Object.prototype.toString.call(e)}return{isBrowser:typeof a!=="undefined"&&typeof a.document!=="undefined",isWorker:typeof self==="object"&&self.constructor&&0<=(self.constructor.name||"").indexOf("WorkerGlobalScope"),isNode:typeof process!=="undefined"&&process.versions!=null&&process.versions.node!=null,addEventListenerSafe:function(e,n,i,s){e.addEventListener?e.addEventListener(n,i,s):e.attachEvent&&e.attachEvent("on"+n,i)},afterDocumentLoad:function(e){if(o.isWorker)o.defer(e);else{var n=!1;f.readyState==="complete"?o.defer(e):(o.addEventListenerSafe(f,"readystatechange",function(){f.readyState!=="complete"||n||(o.defer(e),n=!0)}),setTimeout(function(){n||(o.defer(e),n=!0)},1e4))}},bind:function(e,n){return function(){return e.apply(n,Array.prototype.slice.call(arguments))}},contains:function(e,n){return 0<=e.indexOf(n)},defaults:function(e){return t(e,Array.prototype.slice.call(arguments,1),!1)},defaultsDeep:function(e){return t(e,Array.prototype.slice.call(arguments,1),!0)},defer:function(e,n){setTimeout(function(){e.apply(n)})},forEach:function(e,n,i){if(o.isArray(e)){if(e.forEach)return e.forEach(n,i);for(var s=0;s<e.length;)n.call(i,e[s],s,e),s++}},getLocation:function(){return a.location.toString().replace(/ /g,"%20")},getLocationURL:function(){return o.parseURL(o.getLocation())},has:function(e,n){try{for(var i=n.split("."),s=e,c=0;c<i.length;c++)if(s[i[c]])s=s[i[c]];else return!1;return!0}catch(u){return!1}},hasFunction:function(e,n){try{return!!e[n]}catch(i){return!1}},hasOwn:function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},isArray:function(e){return r(e)==="[object Array]"},isBoolean:function(e){return typeof e==="boolean"||o.isObject(e)&&r(e)==="[object Boolean]"},isBrowserIE:function(e){e=e||a.navigator.userAgent;var n=e.match(/Trident\/([\d.]+)/);return n&&n[1]==="7.0"?11:(e=e.match(/MSIE ([\d.]+)/))?parseInt(e[1],10):!1},isBrowserSupported:function(){var e=this.isBrowserIE();return!e||8<=e},isError:function(e){if(!o.isObject(e))return!1;var n=r(e);return n==="[object Error]"||n==="[object DOMException]"||o.isString(e.name)&&o.isString(e.message)},isElement:function(e){return o.isObject(e)&&e.nodeType===1},isFunction:function(e){return!(!e||typeof e!=="function")},isNumber:function(e){return typeof e==="number"||o.isObject(e)&&r(e)==="[object Number]"},isObject:function(e){return!(!e||typeof e!=="object")},isString:function(e){return typeof e==="string"||!o.isArray(e)&&o.isObject(e)&&r(e)==="[object String]"},isWrappableFunction:function(e){return this.isFunction(e)&&this.hasFunction(e,"apply")},isoNow:function(){var e=new Date;return e.toISOString?e.toISOString():e.getUTCFullYear()+"-"+this.pad(e.getUTCMonth()+1)+"-"+this.pad(e.getUTCDate())+"T"+this.pad(e.getUTCHours())+":"+this.pad(e.getUTCMinutes())+":"+this.pad(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1000).toFixed(3)).slice(2,5)+"Z"},keys:function(e){if(!o.isObject(e))return[];var n=[],i;for(i in e)e.hasOwnProperty(i)&&n.push(i);return n},noop:function(){},pad:function(e){return e=String(e),e.length===1&&(e="0"+e),e},parseURL:function(e){var n=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!n)return{};return n={protocol:n[2],host:n[4],path:n[5],query:n[6],hash:n[8]},n.origin=(n.protocol||"")+"://"+(n.host||""),n.relative=(n.path||"")+(n.query||"")+(n.hash||""),n.href=e,n},patch:function(e,n,i){e[n]=i(e[n]||o.noop)},testCrossdomainXhr:function(){return o.isBrowser&&"withCredentials"in new XMLHttpRequest},truncate:function(e,n){if(e=""+e,e.length<=n)return e;var i=e.length-n;return e.substr(0,n)+"...{"+i+"}"},tryGet:function(e,n){try{return e[n]}catch(i){}},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return(e=="x"?n:n&3|8).toString(16)})},wrapError:function(e){var n=e||Object.prototype.toString.call(e);if(n&&n.innerError)return e;var i=Error("TrackJS Caught: "+(n.message||n));return i.description="TrackJS Caught: "+n.description,i.file=n.file,i.line=n.line||n.lineNumber,i.column=n.column||n.columnNumber,i.stack=n.stack,i.innerError=e,i}}}(),O=function(t,r,e,n,i,s){this.util=t,this.log=r,this.onError=e,this.onFault=n,this.options=s,this.document=i,t.isBrowser&&s.enabled&&this.initialize(i)};O.prototype={initialize:function(t){var r=this.util.bind(this.onDocumentClicked,this),e=this.util.bind(this.onInputChanged,this);t.addEventListener?(t.addEventListener("click",r,!0),t.addEventListener("blur",e,!0)):t.attachEvent&&(t.attachEvent("onclick",r),t.attachEvent("onfocusout",e))},onDocumentClicked:function(t){try{var r=this.getElementFromEvent(t);r&&r.tagName&&(this.isDescribedElement(r,"a")||this.isDescribedElement(r,"button")||this.isDescribedElement(r,"input",["button","submit"])?this.writeVisitorEvent(r,"click"):this.isDescribedElement(r,"input",["checkbox","radio"])&&this.writeVisitorEvent(r,"input",r.value,r.checked))}catch(e){this.onFault(e)}},onInputChanged:function(t){try{var r=this.getElementFromEvent(t);if(r&&r.tagName)if(this.isDescribedElement(r,"textarea"))this.writeVisitorEvent(r,"input",r.value);else if(this.isDescribedElement(r,"select")&&r.options&&r.options.length)this.onSelectInputChanged(r);else this.isDescribedElement(r,"input")&&!this.isDescribedElement(r,"input",["button","submit","hidden","checkbox","radio"])&&this.writeVisitorEvent(r,"input",r.value)}catch(e){this.onFault(e)}},onSelectInputChanged:function(t){if(t.multiple)for(var r=0;r<t.options.length;r++)t.options[r].selected&&this.writeVisitorEvent(t,"input",t.options[r].value);else 0<=t.selectedIndex&&t.options[t.selectedIndex]&&this.writeVisitorEvent(t,"input",t.options[t.selectedIndex].value)},writeVisitorEvent:function(t,r,e,n){this.getElementType(t)==="password"&&(e=h);var i=this.getElementAttributes(t);t.innerText&&(i.__trackjs_element_text=this.util.truncate(t.innerText,500)),this.log.add("v",{timestamp:this.util.isoNow(),action:r,element:{tag:t.tagName.toLowerCase(),attributes:i,value:this.getMetaValue(e,n)}})},getElementFromEvent:function(t){return t.target||f.elementFromPoint(t.clientX,t.clientY)},isDescribedElement:function(t,r,e){if(t.tagName.toLowerCase()!==r.toLowerCase())return!1;if(!e)return!0;t=this.getElementType(t);for(r=0;r<e.length;r++)if(e[r]===t)return!0;return!1},getElementType:function(t){return(t.getAttribute("type")||"").toLowerCase()},getElementAttributes:function(t){for(var r={},e=Math.min(t.attributes.length,10),n=0;n<e;n++){var i=t.attributes[n];o.contains(["data-value","value"],i.name.toLowerCase())||(r[i.name]=o.truncate(i.value,100))}return r},getMetaValue:function(t,r){return t===h?h:{length:t.length,pattern:this.matchInputPattern(t),checked:r}},matchInputPattern:function(t){return t===""?"empty":/^[a-z0-9!#$%&'*+=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/.test(t)?"email":/^(0?[1-9]|[12][0-9]|3[01])[\/\-](0?[1-9]|1[012])[\/\-]\d{4}$/.test(t)||/^(\d{4}[\/\-](0?[1-9]|1[012])[\/\-]0?[1-9]|[12][0-9]|3[01])$/.test(t)?"date":/^(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?$/.test(t)?"usphone":/^\s*$/.test(t)?"whitespace":/^\d*$/.test(t)?"numeric":/^[a-zA-Z]*$/.test(t)?"alpha":/^[a-zA-Z0-9]*$/.test(t)?"alphanumeric":"characters"},report:function(){return this.log.all("v")}};var C=function(t,r,e,n,i){this.onError=t,this.onFault=r,this.serialize=e,i.enabled&&this.watchWindowErrors(n),i.promise&&this.watchPromiseErrors(n)};C.prototype={watchPromiseErrors:function(t){var r=this;t.addEventListener?t.addEventListener("unhandledrejection",function(e){try{e=e||{};var n=e.detail?o.tryGet(e.detail,"reason"):o.tryGet(e,"reason");if(n!==h&&n!==null&&!n.__trackjs_state__){if(!o.isError(n))try{throw Error(r.serialize(n))}catch(i){n=i}r.onError("promise",n)}}catch(i){r.onFault(i)}}):o.patch(t,"onunhandledrejection",function(e){return function(n){r.onError("promise",n),e.apply(this,arguments)}})},watchWindowErrors:function(t){var r=this;o.patch(t,"onerror",function(e){return function(n,i,s,c,u){try{if(o.isError(u)){r.onError("window",u),e.apply(this,arguments);return}u=u||{};var p={message:u.message||r.serialize(n),name:u.name||"Error",line:u.line||parseInt(s,10)||null,column:u.column||parseInt(c,10)||null,stack:u.stack||null};Object.prototype.toString.call(n)!=="[object Event]"||i?p.file=u.file||r.serialize(i):p.file=(n.target||{}).src,r.onError("window",p)}catch(m){r.onFault(m)}e.apply(this,arguments)}})}};var L=function(){this.hasInstalled=!1,this.hasEnabled=!0,this.window=a,this.document=f,this.util=o,this.install=o.bind(this.install,this),this.onError=o.bind(this.onError,this),this.onFault=o.bind(this.onFault,this),this.serialize=o.bind(this.serialize,this),this.log=new j(o),this.metadata=new I(this.serialize);var t=a&&(a._trackJs||a._trackJS||a._trackjs);t&&this.install(t)};return L.prototype={install:function(t){try{if(o.isNode)return this.warn("monitoring disabled in node"),!1;if(!o.has(t,"token"))return this.warn("missing token"),!1;if(this.hasInstalled)return this.warn("already installed"),!1;if(this.config=new w(t),this.transmitter=new k(this.util,this.config),this.environment=new _(this.config),this.customer=new S(this.config,this.util,this.log,this.window,this.document),!this.config.current.enabled)return this.hasEnabled=!1;if(this.windowConsoleWatcher=new E(this.util,this.log,this.onError,this.onFault,this.serialize,this.window,this.config.current.console),!this.util.isBrowserSupported())return!1;this.callbackWatcher=new v(this.config.current.callback,this.onError,this.onFault),this.visitorWatcher=new O(this.util,this.log,this.onError,this.onFault,this.document,this.config.current.visitor),this.navigationWatcher=new x(this.log,this.config.current.navigation),this.networkWatcher=new T(this.util,this.log,this.onError,this.onFault,this.window,this.config.current.network),this.windowWatcher=new C(this.onError,this.onFault,this.serialize,this.window,this.config.current.window);var r=this;return o.afterDocumentLoad(function(){r.transmitter.sendUsage({token:r.customer.token,correlationId:r.customer.correlationId,application:r.config.current.application,x:r.util.uuid()})}),this.hasInstalled=!0}catch(e){return this.onFault(e),!1}},pub:function(){var t=this,r={addMetadata:this.metadata.addMetadata,attempt:function(e,n){try{var i=Array.prototype.slice.call(arguments,2);return e.apply(n||this,i)}catch(s){throw t.onError("catch",s),o.wrapError(s)}},configure:function(e){return!t.hasInstalled&&t.hasEnabled?(t.warn("agent must be installed"),!1):t.config.setCurrent(e)},hash:"ee2d3930f78cfd8bb97c23558688dedfac2d12ce",isInstalled:function(){return t.hasInstalled},install:this.install,removeMetadata:this.metadata.removeMetadata,track:function(e){if(!t.hasInstalled&&t.hasEnabled)t.warn("agent must be installed");else{var n=o.isError(e)?e.message:t.serialize(e);if(e=e||{},!e.stack)try{throw Error(n)}catch(i){e=i}t.onError("direct",e)}},version:"3.10.4",watch:function(e,n){return function(){try{var i=Array.prototype.slice.call(arguments,0);return e.apply(n||this,i)}catch(s){throw t.onError("catch",s),o.wrapError(s)}}},watchAll:function(e){var n=Array.prototype.slice.call(arguments,1),i;for(i in e)typeof e[i]!=="function"||o.contains(n,i)||(e[i]=this.watch(e[i],e));return e}};return new E(o,t.log,t.onError,t.onFault,t.serialize,r,w.prototype.defaults.console),r},onError:function(){var t,r=!1;return function(e,n,i){if(this.hasInstalled&&this.hasEnabled&&o.isBrowserSupported())try{if(i=i||{bindStack:null,bindTime:null,force:!1},n&&o.isError(n)||(n={name:"Error",message:this.serialize(n,i.force)}),n.message.indexOf("TrackJS Caught")===-1)if(r&&n.message.indexOf("Script error")!==-1)r=!1;else{var s=o.defaultsDeep({},{agentPlatform:o.isBrowser?"browser":"worker",bindStack:i.bindStack,bindTime:i.bindTime,column:n.column||n.columnNumber,console:this.windowConsoleWatcher.report(),customer:this.customer.report(),entry:e,environment:this.environment.report(),file:n.file||n.fileName,line:n.line||n.lineNumber,message:n.message,metadata:this.metadata.report(),nav:this.navigationWatcher.report(),network:this.networkWatcher.report(),url:(a.location||"").toString(),stack:n.stack,timestamp:this.util.isoNow(),visitor:this.visitorWatcher.report(),version:"3.10.4"});if(!i.force)try{if(!this.config.current.onError(s,n))return}catch(p){s.console.push({timestamp:this.util.isoNow(),severity:"error",message:p.message});var c=this;setTimeout(function(){c.onError("catch",p,{force:!0})},0)}if(this.config.current.dedupe){var u=(s.message+s.stack).substr(0,1e4);if(u===t)return;t=u}(function(){function p(){var g=0;return o.forEach(s.console,function(l){g+=(l.message||"").length}),80000<=g}for(var m=0;p()&&m<s.console.length;)s.console[m].message=o.truncate(s.console[m].message,1000),m++})(),this.log.clear(),setTimeout(function(){r=!1}),r=!0,this.transmitter.sendError(s,this.customer.token)}}catch(p){this.onFault(p)}}}(),onFault:function(t){var r=this.transmitter||new k;t=t||{},t={token:(this.customer||{}).token,file:t.file||t.fileName,msg:t.message||"unknown",stack:(t.stack||"unknown").substr(0,1000),url:this.window.location,v:"3.10.4",h:"ee2d3930f78cfd8bb97c23558688dedfac2d12ce",x:this.util.uuid()},r.sendTrackerFault(t)},serialize:function(t,r){if(this.hasInstalled&&this.config.current.serialize&&!r)try{return this.config.current.serialize(t)}catch(e){this.onError("catch",e,{force:!0})}return w.prototype.defaults.serialize(t)},warn:function(t){o.has(a,"console.warn")&&a.console.warn("TrackJS: "+t)}},new L().pub()}(typeof self==="undefined"?void 0:self,typeof document==="undefined"?void 0:document);class b{casinoChannel;trackingActive=!1;constructor(){this.casinoChannel=window.hacksawCasino.PubSub.getChannel("casino"),this.start(),this.setupErrorHandlers()}async start(){this.casinoChannel.subscribe("initData",(a)=>{let h=new RegExp("_ci$|_test$").test(a.partner);if(this.trackingActive=a.deployEnv!=="{local}"&&!h,this.trackingActive)y.install({token:"e1e103d743194be28fb1aa6ffee15a5d",application:this.createSlugFromName(String(a.gameName)),userId:a.playerId,sessionId:a.sessionUuid,version:a.gameVersion,console:{error:!1,warn:!1},callback:{enabled:!1},network:{error:!1},window:{enabled:!1,promise:!1}}),y.addMetadata("gameVersion",a.gameVersion)})}setupErrorHandlers(){this.casinoChannel.subscribe("logErrorExternally",(a)=>{if(this.trackingActive&&a.errorWarning===""){let f=["gameName","gameId","packageName","replayUrl","channel","partner","currency","branding","elapsed","freeRoundMode","featureBuy","autoplayMode","env","activePromotion","turbospin","superTurbospin","orientation","errorSource","errorStack","errorId","deviceData","currentUiState","previousUiState","devicePixelRatio","mode","deployEnv"];for(let[h,v]of Object.entries(a)){if(!f.includes(h)||v==="")continue;if(h=="deviceData")y.addMetadata("gpu",String(v.gpu));else y.addMetadata(h,String(v))}y.track(String(a.errorMessage))}})}createSlugFromName(a){return a.replace(/[^\w\s-]/g,"").trim().replace(/\s+/g,"-").toLowerCase().substring(0,25)}}new b;
